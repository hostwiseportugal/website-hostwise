---
import { iconMap } from '../icons/iconMap';

interface Feature {
  title: string;
  description: string;
  icon: string; // key from iconMap
}

interface Props {
  badge?: string;
  title?: string;
  subtitle?: string;
  features?: Feature[];
}

const {
  badge = "Serviços Incluídos",
  title = "O Nosso Serviço Completo de Gestão",
  subtitle = "Gestão completa end-to-end para que não tenha de se preocupar com nada",
  features = [
    {
      title: "Sistemas de Self Check-In e Check-Out",
      description: "Entrada e saída flexíveis, sem complicações. Os hóspedes podem aceder ao alojamento de forma autónoma, garantindo total conveniência.",
      icon: "key"
    },
    {
      title: "Apoio ao Hóspede 24/7",
      description: "Assistência disponível a qualquer hora do dia ou da noite, para resolver qualquer questão e garantir que os hóspedes tenham uma experiência impecável.",
      icon: "support247"
    },
    {
      title: "Roupa de Cama e Atoalhados",
      description: "Lençóis e toalhas de qualidade, sempre limpos e bem cuidados, para garantir uma estadia agradável e confortável.",
      icon: "bed"
    },
    {
      title: "Artigos de Higiene Pessoal",
      description: "Cada alojamento é cuidadosamente preparado com amenities de qualidade, pensados para proporcionar uma experiência confortável, elegante e sem preocupações desde o primeiro momento.",
      icon: "amenities"
    },
    {
      title: "Apoio na Obtenção de Licenças AL",
      description: "Ajudamos em todo o processo de registo da propriedade como alojamento local, facilitando o licenciamento e assegurando a conformidade com os requisitos legais.",
      icon: "license"
    },
    {
      title: "Criação e Otimização de Anúncios",
      description: "Criamos descrições apelativas e bem estruturadas, que valorizam as características únicas de cada imóvel e aumentam a taxa de conversão em reservas.",
      icon: "adOptimization"
    },
    {
      title: "Verificação dos Hóspedes",
      description: "Aplicamos critérios de selecção rigorosos para garantir que o seu imóvel é ocupado por hóspedes responsáveis e de confiança.",
      icon: "userVerify"
    },
    {
      title: "Fotografia Profissional",
      description: "Captamos o melhor do seu imóvel com um olhar técnico e apurado, criando imagens que valorizam o espaço, despertam interesse e destacam o anúncio num mercado altamente competitivo.",
      icon: "camera"
    },
    {
      title: "Serviços de Limpeza",
      description: "As nossas equipas são experientes e asseguram uma limpeza cuidada e consistente entre estadias, mantendo elevados padrões de higiene e apresentação.",
      icon: "cleaning"
    },
    {
      title: "Manutenção de Propriedades",
      description: "Realizamos intervenções preventivas e corretivas com rapidez e eficiência, assegurando o bom estado do imóvel a longo prazo.",
      icon: "maintenance"
    },
    {
      title: "Gestão de Reclamações e Avaliações",
      description: "Acompanhamos e respondemos a comentários e avaliações, promovendo uma reputação positiva e assegurando a satisfação contínua dos hóspedes.",
      icon: "reviews"
    }
  ]
} = Astro.props;
---

<section class="features-grid-section">
  <div class="container">
    <div class="section-header">
      <span class="section-badge">{badge}</span>
      <h2>{title}</h2>
      <p>{subtitle}</p>
    </div>

    <div class="features-grid">
      {features.map((feature, index) => (
        <article
          class="feature-card"
          style={`--delay: ${0.05 * index}s`}
          data-accordion
        >
          <button class="card-header" type="button" aria-expanded="false">
            <div class="card-icon">
              <Fragment set:html={iconMap[feature.icon] || iconMap.check} />
            </div>
            <h3>{feature.title}</h3>
            <div class="card-toggle">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
              </svg>
            </div>
          </button>
          <div class="card-content">
            <p>{feature.description}</p>
          </div>
        </article>
      ))}
    </div>
  </div>
</section>

<style>
  .features-grid-section {
    padding: 100px 20px;
    background: linear-gradient(180deg, #F8FCFF 0%, #fff 100%);
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
  }

  .section-header {
    text-align: center;
    margin-bottom: 60px;
  }

  .section-badge {
    display: inline-block;
    background: rgba(92, 176, 214, 0.15);
    color: var(--secondary);
    padding: 8px 20px;
    border-radius: 24px;
    font-weight: 700;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 16px;
  }

  .section-header h2 {
    font-size: 2.75rem;
    color: var(--primary);
    margin-bottom: 16px;
    line-height: 1.2;
  }

  .section-header p {
    font-size: 1.15rem;
    color: var(--text);
    opacity: 0.8;
    max-width: 700px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Grid Layout */
  .features-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 16px;
  }

  @media (min-width: 640px) {
    .features-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .features-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1280px) {
    .features-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  /* Feature Card */
  .feature-card {
    position: relative;
    background: white;
    border: 2px solid var(--gray-light);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s ease;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.5s ease forwards;
    animation-delay: var(--delay);
  }

  .feature-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
  }

  .feature-card:hover::before,
  .feature-card.active::before {
    transform: scaleX(1);
  }

  .feature-card:hover,
  .feature-card.active {
    border-color: var(--secondary);
    box-shadow: 0 8px 24px rgba(12, 68, 99, 0.08);
  }

  /* Card Header (Button) */
  .card-header {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 20px;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
    transition: background 0.2s ease;
  }

  .card-header:hover {
    background: rgba(92, 176, 214, 0.05);
  }

  /* Card Icon */
  .card-icon {
    width: 44px;
    height: 44px;
    background: var(--blue-light);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--secondary);
    flex-shrink: 0;
    transition: all 0.3s ease;
  }

  .card-icon :global(svg) {
    width: 22px;
    height: 22px;
  }

  .feature-card.active .card-icon {
    background: var(--secondary);
    color: white;
  }

  /* Card Title */
  .card-header h3 {
    flex: 1;
    font-size: 0.95rem;
    color: var(--primary);
    margin: 0;
    font-weight: 600;
    line-height: 1.3;
  }

  /* Toggle Icon */
  .card-toggle {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--secondary);
    transition: transform 0.3s ease;
    flex-shrink: 0;
  }

  .feature-card.active .card-toggle {
    transform: rotate(180deg);
  }

  /* Card Content (Accordion Body) */
  .card-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
  }

  .feature-card.active .card-content {
    max-height: 200px;
  }

  .card-content p {
    font-size: 0.9rem;
    line-height: 1.6;
    color: var(--text);
    opacity: 0.85;
    margin: 0;
    padding: 0 20px 20px 78px;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .features-grid-section {
      padding: 80px 20px;
    }

    .section-header h2 {
      font-size: 2.25rem;
    }
  }

  @media (max-width: 768px) {
    .section-header {
      margin-bottom: 40px;
    }

    .section-header h2 {
      font-size: 1.85rem;
    }

    .section-header p {
      font-size: 1rem;
    }

    .card-header {
      padding: 16px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
    }

    .card-icon :global(svg) {
      width: 20px;
      height: 20px;
    }

    .card-header h3 {
      font-size: 0.9rem;
    }

    .card-content p {
      font-size: 0.85rem;
      padding: 0 16px 16px 70px;
    }
  }

  @media (max-width: 640px) {
    .card-content p {
      padding: 0 16px 16px 16px;
    }
  }
</style>

<script>
  function initAccordions() {
    const cards = document.querySelectorAll('[data-accordion]');

    cards.forEach(card => {
      const button = card.querySelector('.card-header');

      button?.addEventListener('click', () => {
        const isActive = card.classList.contains('active');

        // Close all other accordions in the same grid (optional - remove for independent behavior)
        // const grid = card.closest('.features-grid');
        // grid?.querySelectorAll('[data-accordion].active').forEach(openCard => {
        //   if (openCard !== card) {
        //     openCard.classList.remove('active');
        //     openCard.querySelector('.card-header')?.setAttribute('aria-expanded', 'false');
        //   }
        // });

        // Toggle current accordion
        card.classList.toggle('active');
        button.setAttribute('aria-expanded', (!isActive).toString());
      });
    });
  }

  // Initialize on DOM ready
  if (typeof window !== 'undefined') {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAccordions);
    } else {
      initAccordions();
    }
  }
</script>
