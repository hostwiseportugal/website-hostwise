---
import GuestySearchWidget from '../components/GuestySearchWidget.astro';
import OptimizedImage from './OptimizedImage.astro';
import type { ImageMetadata } from 'astro';
import { property1, property2, heroDefault } from '../lib/fallback-images';

interface HeroImage {
  image?: { url?: string; alt?: string };
  alt?: string;
}

interface HeroToggleProps {
  tabOwnerLabel?: string;
  tabGuestLabel?: string;
  images?: HeroImage[];

  ownerBadge?: string;
  ownerTitle?: string;
  ownerText?: string;
  ownerCtaLabel?: string;
  ownerCtaUrl?: string;
  ownerSwitchLabel?: string;

  guestBadge?: string;
  guestTitle?: string;
  guestText?: string;
  guestSwitchLabel?: string;
}

const {
  tabOwnerLabel = 'Sou Proprietário',
  tabGuestLabel = 'Sou Hóspede',
  images = [],

  ownerBadge = 'Gestão de Alojamento Local e Asset Management de Hospitalidade',
  ownerTitle = 'Do Apartamento ao Portfolio. Gestão que Maximiza Rentabilidade.',
  ownerText = 'Gestão profissional que combina standards hoteleiros, tecnologia avançada, e conhecimento profundo do mercado português. Para proprietários individuais, edifícios completos, e portfolios institucionais.',
  ownerCtaLabel = 'Quero Receber uma Proposta',
  ownerCtaUrl = '#contacto',
  ownerSwitchLabel = 'Sou hóspede →',

  guestBadge = 'Reserve Diretamente com a HostWise',
  guestTitle = 'Book. Stay. Repeat.',
  guestText = 'Alojamentos Locais espalhados por Portugal aos melhores preços. Reserve Já!',
  guestSwitchLabel = 'Sou proprietário →',
} = Astro.props as HeroToggleProps;

// fallback de imagens se ainda não tiveres nada no ACF
const heroImages: { src: ImageMetadata | string; alt: string }[] =
  images.length > 0
    ? images.map((item, index) => ({
        src: item.image?.url || '',
        alt: item.alt || item.image?.alt || `Hero image ${index + 1}`,
      })).filter(img => img.src)
    : [
        { src: property1, alt: 'Apartamento moderno' },
        { src: heroDefault, alt: 'Sala ampla com vista' },
        { src: property2, alt: 'Espaço de refeições' },
      ];
---

<section class="hero-new">
  <div class="hero-wrapper">
    <!-- Tabs -->
    <div class="toggle-tabs">
      <button class="toggle-tab active" data-tab="owners">
        {tabOwnerLabel}
      </button>
      <button class="toggle-tab" data-tab="guests">
        {tabGuestLabel}
      </button>
    </div>

    <div class="hero-grid">
      <!-- Imagens -->
      <div class="hero-images">
        {heroImages.map((img, index) => (
          <div class="image-item">
            <OptimizedImage src={img.src} alt={img.alt} loading={index === 0 ? 'eager' : 'lazy'} />
          </div>
        ))}
      </div>

      <!-- Conteúdo -->
      <div class="hero-main">
        <!-- TAB PROPRIETÁRIOS -->
        <div class="tab-content active" data-content="owners">
          {ownerBadge && <h1>{ownerBadge}</h1>}

          {ownerTitle && <h2>{ownerTitle}</h2>}

          {ownerText && <p>{ownerText}</p>}

          <div class="cta-buttons">
            {ownerCtaLabel && (
              <a href={ownerCtaUrl} class="btn-primary-hero">
                {ownerCtaLabel}
              </a>
            )}

            {ownerSwitchLabel && (
              <button class="link-switch" data-switch="guests">
                {ownerSwitchLabel}
              </button>
            )}
          </div>
        </div>

        <!-- TAB HÓSPEDES -->
        <div class="tab-content" data-content="guests">
          {guestBadge && <span class="label">{guestBadge}</span>}

          {guestTitle && <div class="title-large">{guestTitle}</div>}

          {guestText && <p>{guestText}</p>}

          <div class="booking-form">
            <GuestySearchWidget />

            {guestSwitchLabel && (
              <button class="link-switch" data-switch="owners">
                {guestSwitchLabel}
              </button>
            )}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<style>
  .hero-new {
    background: linear-gradient(135deg, #E5F4FE 0%, #fff 100%);
    padding: 100px 20px 60px;
    min-height: 100vh;
    display: flex;
    align-items: center;
  }

  .hero-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
  }

  .toggle-tabs {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 50px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 6px;
    border-radius: 50px;
    width: fit-content;
    margin-left: auto;
    margin-right: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }

  .toggle-tab {
    padding: 10px 28px;
    border: none;
    background: transparent;
    border-radius: 50px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    color: #2D2D2D;
  }

  .toggle-tab.active {
    background: #0C4463;
    color: white;
  }

  .hero-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: center;
  }

  .hero-images {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    height: 500px;
  }

  .image-item {
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
  }

  .image-item:nth-child(2) {
    transform: translateY(30px);
  }

  .image-item:nth-child(3) {
    transform: translateY(15px);
  }

  .image-item {
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0,0,0,0.1);
  height: 100%; /* garante que cada card ocupa a altura do grid */
}

/* quando OptimizedImage gera <picture> */
.image-item :global(picture) {
  display: block;
  width: 100%;
  height: 100%;
}

.image-item :global(img) {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.hero-images {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  height: 500px;
}

.image-item {
  height: 100%;
}


  .hero-main {
    position: relative;
  }

  .tab-content {
    display: none;
    animation: fadeIn 0.5s;
  }

  .tab-content.active {
    display: block;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* H1 - Aparência de label pequeno (apenas proprietários) */
  .tab-content h1 {
    display: inline-block;
    background: rgba(92, 176, 214, 0.15);
    color: #0A75AF;
    padding: 6px 18px;
    border-radius: 30px;
    font-size: 0.85rem;
    font-weight: 600;
    margin: 0 0 16px 0;
  }

  /* H2 - Aparência de título grande (apenas proprietários) */
  .tab-content h2 {
    font-size: 3rem;
    color: #0C4463;
    margin: 0 0 16px 0;
    line-height: 1.1;
    font-weight: 700;
  }

  /* Label para hóspedes (visual igual ao H1 mas sem heading) */
  .label {
    display: inline-block;
    background: rgba(92, 176, 214, 0.15);
    color: #0A75AF;
    padding: 6px 18px;
    border-radius: 30px;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 16px;
  }

  /* Title large para hóspedes (visual igual ao H2 mas sem heading) */
  .title-large {
    font-size: 3rem;
    color: #0C4463;
    margin: 0 0 16px 0;
    line-height: 1.1;
    font-weight: 700;
  }

  .tab-content p {
    font-size: 1.15rem;
    color: #2D2D2D;
    margin-bottom: 32px;
    opacity: 0.9;
    line-height: 1.6;
  }

  .cta-buttons {
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: flex-start;
  }

  .btn-primary-hero {
    padding: 16px 40px;
    background: linear-gradient(135deg, #0C4463 0%, #0A75AF 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-block;
  }

  .btn-primary-hero:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(12, 68, 99, 0.3);
  }

  .link-switch {
    background: none;
    border: none;
    color: #0A75AF;
    font-weight: 600;
    cursor: pointer;
    font-size: 0.95rem;
    padding: 0;
    transition: color 0.3s;
  }

  .link-switch:hover {
    color: #0C4463;
  }

  /* Booking Form */
  .booking-form {
    background: white;
    padding: 28px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .form-row {
    display: flex;
    gap: 12px;
  }

  .form-row.two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
  }

  .booking-form input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #f8f9fa;
    border-radius: 10px;
    font-size: 0.95rem;
  }

  .booking-form input:focus {
    outline: none;
    border-color: #5CB0D6;
  }

  .booking-form .btn-primary-hero {
    width: 100%;
    text-align: center;
    margin-top: 4px;
  }

  .booking-form .link-switch {
    text-align: center;
    width: 100%;
    margin-top: 8px;
  }

  @media (max-width: 1024px) {
    .hero-new {
      padding: 100px 20px 40px;
      min-height: auto;
    }

    .hero-grid {
      grid-template-columns: 1fr;
      gap: 40px;
    }

    .hero-images {
      order: 2;
      height: 350px;
    }

    .hero-main {
      order: 1;
    }

    .tab-content h2,
    .title-large {
      font-size: 2.5rem;
    }
  }

  @media (max-width: 768px) {
    .hero-new {
      padding: 90px 20px 40px;
    }

    .toggle-tabs {
      width: 100%;
      max-width: 100%;
      margin-bottom: 32px;
      padding: 4px;
      gap: 4px;
    }

    .toggle-tab {
      padding: 12px 20px;
      font-size: 0.9rem;
      flex: 1;
      text-align: center;
    }

    .toggle-tab.active {
      box-shadow: 0 2px 8px rgba(12, 68, 99, 0.2);
    }

    .tab-content h1,
    .label {
      font-size: 0.8rem;
      padding: 5px 14px;
      margin-bottom: 12px;
    }

    .tab-content h2,
    .title-large {
      font-size: 2rem;
      margin-bottom: 12px;
    }

    .tab-content p {
      font-size: 1rem;
      margin-bottom: 24px;
    }

    .hero-images {
      grid-template-columns: 1fr;
      height: auto;
      gap: 12px;
    }

    .image-item {
      height: 200px;
    }

    .image-item:nth-child(2),
    .image-item:nth-child(3) {
      transform: translateY(0);
    }

    .form-row.two-col {
      grid-template-columns: 1fr;
    }

    .booking-form {
      padding: 20px;
    }

    .cta-buttons {
      width: 100%;
    }

    .btn-primary-hero {
      width: 100%;
      text-align: center;
      padding: 14px 32px;
      font-size: 1rem;
    }

    .link-switch {
      width: 100%;
      text-align: left;
      padding: 8px 0;
    }
  }

  /* Melhorias extra para telas muito pequenas */
  @media (max-width: 480px) {
    .hero-new {
      padding: 80px 16px 32px;
    }

    .toggle-tabs {
      margin-bottom: 28px;
    }

    .toggle-tab {
      padding: 10px 16px;
      font-size: 0.85rem;
    }

    .tab-content h1,
    .label {
      font-size: 0.75rem;
    }

    .tab-content h2,
    .title-large {
      font-size: 1.75rem;
    }

    .image-item {
      height: 180px;
    }
  }

</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('[data-tab]');
    const contents = document.querySelectorAll('[data-content]');
    const switches = document.querySelectorAll('[data-switch]');

    // Filtra apenas os elementos do hero (que têm "owners" ou "guests")
    const heroTabs = Array.from(tabs).filter(t => 
      t.getAttribute('data-tab') === 'owners' || 
      t.getAttribute('data-tab') === 'guests'
    );

    const heroContents = Array.from(contents).filter(c => 
      c.getAttribute('data-content') === 'owners' || 
      c.getAttribute('data-content') === 'guests'
    );

    function switchTo(target: string) {
      heroTabs.forEach(t => {
        const tab = t as HTMLElement;
        tab.classList.toggle('active', tab.dataset.tab === target);
      });
      
      heroContents.forEach(c => {
        const content = c as HTMLElement;
        content.classList.toggle('active', content.dataset.content === target);
      });
    }

    heroTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const htmlTab = tab as HTMLElement;
        switchTo(htmlTab.dataset.tab!);
      });
    });

    switches.forEach(sw => {
      sw.addEventListener('click', () => {
        const htmlSwitch = sw as HTMLElement;
        switchTo(htmlSwitch.dataset.switch!);
      });
    });
  });
</script>