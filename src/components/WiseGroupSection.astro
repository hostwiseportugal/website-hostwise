---
import { iconMap } from '../icons/iconMap';

interface CompanyRaw {
  name?: string;
  company_name?: string;

  tagline?: string;
  company_tagline?: string;

  description?: string;
  company_description?: string;

  link?: string;
  company_link?: string;

  color?: string;
  company_color?: string;

  icon_key?: string;
  company_icon_key?: string;
}

interface Company {
  name: string;
  tagline?: string;
  description?: string;
  link?: string;
  color?: string;
  icon_key?: string;
}

interface WiseGroupProps {
  badge?: string;
  title?: string;
  intro?: string;       // pode vir com HTML do ACF
  companies?: CompanyRaw[];
}

// helper icons
function getIcon(key: string | undefined, fallbackKey: keyof typeof iconMap) {
  if (key && key in iconMap) {
    return iconMap[key as keyof typeof iconMap];
  }
  return iconMap[fallbackKey];
}

const {
  badge = 'Wise Group',
  title = 'Host Wise, uma marca Wise Group',
  intro = `O Wise Group dedica-se a apresentar aos seus clientes soluções para a maximização dos seus investimentos. O nosso foco começou na gestão e valorização de propriedades, através do alojamento local. Realizamos igualmente consultoria imobiliária, auxiliando investidores institucionais a darem os primeiros passos no mercado português.`,
  companies: companiesRaw = [],
} = Astro.props as WiseGroupProps;

// Fallback companies (igual ao teu markup original, mas com icon_key)
const fallbackCompanies: Company[] = [
  {
    name: 'Host Wise',
    tagline: 'Gestão de Propriedades',
    description:
      'Gerimos imóveis turísticos com rigor hoteleiro, tecnologia avançada e experiência real no mercado português.',
    link: '/',
    color: '#5CB0D6',
    icon_key: 'home',
  },
  {
    name: 'Work Wise',
    tagline: 'Espaços de Escritório',
    description:
      'Escritórios modernos e flexíveis para empresas e profissionais que procuram ambientes de trabalho premium.',
    link: 'https://workwise.pt',
    color: '#5CB0D6',
    icon_key: 'briefcase',
  },
  {
    name: 'Invest Wise',
    tagline: 'Consultoria Imobiliária',
    description:
      'Auxiliamos investidores na identificação, compra e venda de propriedades de alto potencial de rentabilidade.',
    link: 'https://investwise.pt',
    color: '#5CB0D6',
    icon_key: 'trendingUp',
  },
];

// Normalizar o que vem do ACF (ou cair no fallback)
const companies: Company[] =
  (companiesRaw && companiesRaw.length > 0)
    ? companiesRaw
        .map((c: CompanyRaw) => ({
          name: c.name ?? c.company_name ?? '',
          tagline: c.tagline ?? c.company_tagline,
          description: c.description ?? c.company_description,
          link: c.link ?? c.company_link,
          color: c.color ?? c.company_color,
          icon_key: c.icon_key ?? c.company_icon_key,
        }))
        .filter((c) => c.name) // garante que só entram empresas com nome
    : fallbackCompanies;
---

<section class="wise-group-section">
  <div class="container">
    <div class="section-intro">
      {badge && <span class="section-badge">{badge}</span>}
      {title && <h2>{title}</h2>}
      {intro && <p set:html={intro}></p>}
    </div>

    <div class="companies-grid">
      {companies.map((company, index) => {
        // fallback de ícone por índice (apenas para não ficar tudo igual)
        const fallbackKey =
          index === 2 ? 'chartLine' : 'homeMultiple';

        const icon = getIcon(company.icon_key, fallbackKey as keyof typeof iconMap);
        const color = company.color || '#5CB0D6';

        const href = company.link || '#';

        return (
          <a
            href={href}
            class="company-card"
            style={`--company-color: ${color}`}
            target={href.startsWith('http') ? '_blank' : undefined}
            rel={href.startsWith('http') ? 'noopener noreferrer' : undefined}
          >
            <div class="card-icon" set:html={icon} />
            <h3>{company.name}</h3>
            {company.tagline && <p class="tagline">{company.tagline}</p>}
            {company.description && (
              <p class="description">{company.description}</p>
            )}

            <div class="card-arrow">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
                width="24"
                height="24"
              >
                <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" />
              </svg>
            </div>
          </a>
        );
      })}
    </div>
  </div>
</section>


<style>
  .wise-group-section {
    padding: 50px 20px 100px 20px;;
    background: white;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .section-intro {
    text-align: center;
    margin-bottom: 60px;
  }

  .section-badge {
    display: inline-block;
    background: rgba(92, 176, 214, 0.15);
    color: var(--secondary);
    padding: 8px 20px;
    border-radius: 24px;
    font-weight: 700;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 16px;
  }

  .section-intro h2 {
    font-size: 3rem;
    color: var(--primary);
    margin-bottom: 16px;
  }

  .section-intro p {
    font-size: 1.15rem;
    color: var(--text);
    opacity: 0.8;
    max-width: 700px;
    margin: 0 auto;
  }

  .companies-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 32px;
    margin-bottom: 80px;
  }

  .company-card {
    position: relative;
    background: white;
    border: 2px solid var(--gray-light);
    border-radius: 20px;
    padding: 40px 32px;
    text-decoration: none;
    transition: all 0.3s;
    overflow: hidden;
  }

  .company-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--company-color);
    transform: scaleX(0);
    transition: transform 0.3s;
  }

  .company-card:hover::before {
    transform: scaleX(1);
  }

  .company-card:hover {
    border-color: var(--company-color);
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
  }

  .card-icon {
  width: 64px;
  height: 64px;
  background: var(--blue-light);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 24px;
  transition: all 0.3s;
  padding: 12px;
}

.card-icon svg {
  color: var(--company-color);
  transition: color 0.3s;
}

.company-card:hover .card-icon {
  background: var(--company-color);
}

.company-card:hover .card-icon svg {
  color: white;
}

  .company-card h3 {
    font-size: 1.75rem;
    color: var(--primary);
    margin: 0 0 8px 0;
  }

  .tagline {
    font-size: 0.95rem;
    color: var(--company-color);
    font-weight: 600;
    margin: 0 0 16px 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .description {
    font-size: 1rem;
    line-height: 1.6;
    color: var(--text);
    margin: 0 0 24px 0;
  }

  .card-arrow {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    color: var(--company-color);
    transition: transform 0.3s;
  }

  .card-arrow svg {
    width: 24px;
    height: 24px;
  }

  .company-card:hover .card-arrow {
    transform: translateX(8px);
  }

  /* Group Benefits */
  .group-benefits {
    background: linear-gradient(135deg, #F8FCFF 0%, #E5F4FE 100%);
    border-radius: 24px;
    padding: 60px 48px;
  }

  .group-benefits h3 {
    text-align: center;
    font-size: 2.25rem;
    color: var(--primary);
    margin: 0 0 48px 0;
  }

  .benefits-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 40px;
  }

  .benefit-item {
    text-align: center;
  }

  .benefit-icon {
    width: 72px;
    height: 72px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  }

  .benefit-icon svg {
    color: var(--secondary);
  }

  .benefit-item h4 {
    font-size: 1.25rem;
    color: var(--primary);
    margin: 0 0 12px 0;
  }

  .benefit-item p {
    font-size: 1rem;
    color: var(--text);
    opacity: 0.9;
    margin: 0;
    line-height: 1.6;
  }

  @media (max-width: 1024px) {
    .companies-grid {
      grid-template-columns: 1fr;
      gap: 24px;
    }

    .benefits-grid {
      grid-template-columns: 1fr;
      gap: 32px;
    }
  }

  @media (max-width: 768px) {
    .wise-group-section {
      padding: 80px 20px;
    }

    .section-intro h2 {
      font-size: 2rem;
    }

    .section-intro p {
      font-size: 1rem;
    }

    .company-card {
      padding: 32px 24px;
    }

    .company-card h3 {
      font-size: 1.5rem;
    }

    .group-benefits {
      padding: 48px 28px;
    }

    .group-benefits h3 {
      font-size: 1.75rem;
    }
  }
</style>